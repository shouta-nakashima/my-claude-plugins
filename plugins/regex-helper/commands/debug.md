# debug - 正規表現デバッグ

正規表現がマッチしない原因を特定し、修正案を提示するコマンドです。

## 実行時の動作

### ステップ1: 正規表現の入力

```
デバッグしたい正規表現を入力してください:
```

### ステップ2: テスト文字列の入力

```
マッチするはずの文字列を入力してください:
```

### ステップ3: 原因分析

正規表現の各部分を順番に検証し、どこで失敗しているかを特定:

```
正規表現: /^[0-9]{3}-[0-9]{4}$/
テスト文字列: "〒123-4567"

✗ マッチしません

原因分析:

ステップ1: ^ (文字列の先頭)
  期待: 文字列が先頭から始まる
  実際: "〒" が先頭にある
  結果: ❌ ここで失敗

ステップ2: [0-9]{3} (数字3桁)
  → 到達せず

診断:
先頭の "〒" が ^ アンカーによってブロックされています。
"123-4567" の部分はパターンに一致しますが、
^ があるため文字列の先頭からマッチを試みます。
```

### ステップ4: 修正案の提示

```
修正案:

1. 〒を許容する（オプショナル）
   /^〒?[0-9]{3}-[0-9]{4}$/
   → "〒123-4567" ✓
   → "123-4567" ✓

2. 〒を必須にする
   /^〒[0-9]{3}-[0-9]{4}$/
   → "〒123-4567" ✓
   → "123-4567" ✗

3. 先頭アンカーを削除（部分マッチ）
   /[0-9]{3}-[0-9]{4}/
   → "〒123-4567" ✓（"123-4567" にマッチ）

どの修正を適用しますか？
```

## よくある問題パターン

### 1. エスケープ忘れ

```
問題: /example.com/ が "exampleXcom" にマッチする
原因: "." は任意の1文字を意味する
修正: /example\.com/
```

### 2. 貪欲マッチの問題

```
問題: /<.*>/ が "<a>text</a>" 全体にマッチ
原因: .* は可能な限り長くマッチする（貪欲）
修正: /<.*?>/ （非貪欲）または /<[^>]+>/
```

### 3. アンカーの誤用

```
問題: /^abc$/ が "abc\ndef" にマッチしない
原因: ^ と $ は文字列全体の先頭/末尾
修正: mフラグを追加 /^abc$/m（各行にマッチ）
```

### 4. 文字クラスの誤解

```
問題: /[A-z]/ が予期しない文字にマッチ
原因: A-z には [\]^_` も含まれる（ASCII順）
修正: /[A-Za-z]/
```

### 5. 日本語の問題

```
問題: /\w+/ が日本語にマッチしない
原因: \w は [A-Za-z0-9_] のみ
修正: /[\w\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FFF]+/
      または /\p{Script=Hiragana}/u （Unicode対応環境）
```

### 6. 改行の問題

```
問題: /.+/ が複数行テキストの1行目だけにマッチ
原因: . は改行にマッチしない
修正: /[\s\S]+/ または sフラグを使用 /.+/s
```

## デバッグのヒント

分析時に以下の点をチェック:

1. **特殊文字のエスケープ**: . * + ? [ ] { } ( ) ^ $ | \
2. **アンカー**: ^ $ の位置と意味
3. **フラグ**: g, i, m, s の有無
4. **文字クラス**: 範囲指定が正しいか
5. **量指定子**: 貪欲/非貪欲の違い
6. **文字エンコーディング**: Unicode対応が必要か
