---
description: "ブランチ名と変更内容から適切なConventional Commits形式のメッセージを自動生成してコミット"
---

# Smart Commit

以下の手順でコミットを実行してください：

## 1. 現在の状態を確認

以下のコマンドを並列で実行してください：
- `git status` で変更ファイルを確認
- `git diff --staged` でステージング済みの変更内容を確認
- `git diff` でステージングされていない変更内容を確認
- `git branch --show-current` で現在のブランチ名を取得

## 2. コミットメッセージの生成

取得した情報から、以下のConventional Commits形式でコミットメッセージを生成してください：

### プレフィックスの選択基準

ブランチ名と変更内容から、以下のプレフィックスを適切に選択してください：

- **feat:** 新機能の追加
  - ブランチ名に `feature/`, `feat/` が含まれる場合
  - 新しいファイルが追加された場合
  - 新しい機能やコンポーネントが実装された場合

- **fix:** バグ修正
  - ブランチ名に `fix/`, `bugfix/`, `hotfix/` が含まれる場合
  - 既存の動作を修正する変更の場合

- **refactor:** コードのリファクタリング
  - ブランチ名に `refactor/` が含まれる場合
  - 機能は変わらないがコード構造を改善した場合

- **docs:** ドキュメントのみの変更
  - README、CLAUDE.mdなどのドキュメントファイルのみの変更
  - コメントの追加・修正

- **style:** コードフォーマットの変更
  - インデント、空白、改行などの調整
  - セミコロンの追加など、コードの動作に影響しない変更

- **test:** テストの追加・修正
  - テストファイルの追加・修正
  - テストケースの追加

- **chore:** ビルドプロセスや補助ツールの変更
  - 依存関係の更新
  - 設定ファイルの変更
  - CI/CD設定の変更

- **perf:** パフォーマンス改善
  - 実行速度やメモリ使用量の最適化

### メッセージの形式

```
<type>: <subject>
```

- **subject**: 変更内容を簡潔に説明（**英語で記述**、50文字以内推奨）
- 命令形で記述（例: "add" not "added" or "adds"）
- 末尾にピリオドは付けない
- 小文字で始める

### 例

```
feat: add user authentication feature
fix: correct error handling in login flow
refactor: restructure API client code
docs: update README with installation steps
chore: update dependencies
```

## 3. ステージング状態の確認と処理

### 3.1 ステージング状態の判定

`git status` の結果から以下を判定してください：

- **ステージング済みの変更がある場合** (`Changes to be committed`)
  - そのままコミット可能

- **ステージングされていない変更がある場合** (`Changes not staged for commit` または `Untracked files`)
  - ユーザーに確認が必要

### 3.2 ステージングされていない変更がある場合の対応

ステージングされていない変更がある場合は、**必ず**以下のように確認を取ってください：

1. 変更されているファイルの一覧を表示
2. AskUserQuestion ツールを使用して以下を確認：
   - 質問: "これらの変更をステージングしてコミットしますか？"
   - 選択肢:
     - "すべてステージングしてコミット" → `git add .` を実行してコミット
     - "現在ステージング済みの変更のみコミット" → ステージング済みがあればそのままコミット、なければエラー
     - "キャンセル" → コミットを中止

3. ユーザーの選択に応じて処理を実行

### 3.3 コミットの実行

1. 生成したメッセージでコミット実行
2. `git log -1` でコミットが正しく作成されたことを確認

## 4. 結果の表示

ユーザーに以下の情報を表示してください：
- 生成されたコミットメッセージ
- コミットされたファイル一覧
- コミットハッシュ

## 注意事項

- コミットメッセージは**1行**で簡潔に記述してください
- 複数の種類の変更が含まれる場合は、最も重要な変更に基づいてプレフィックスを選択してください
- ブランチ名が取得できない場合や、プレフィックスが判断できない場合は、変更内容から適切に推測してください
- **ステージングされていない変更がある場合は、必ずユーザーに確認を取ってください**
- ステージング済みの変更がない場合は、コミットできないことを明確に伝えてください
